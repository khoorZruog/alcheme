# alche:me — 手動 E2E テストガイド

| | |
|---|---|
| **Version** | 1.0 |
| **Date** | 2026-02-16 |
| **Status** | Active |
| **Related** | alcheme_test-scenarios_phase1.md |

> UI の手動 E2E テストを行うための実行手順書。各テストケースの前提条件・操作手順・確認ポイントをまとめる。

---

## 目次

1. [テスト環境の準備](#1-テスト環境の準備)
2. [MT-01: 認証フロー](#mt-01-認証フロー)
3. [MT-02: コスメ登録](#mt-02-コスメ登録)
4. [MT-03: チャット・レシピ生成](#mt-03-チャットレシピ生成)
5. [MT-04: 在庫管理](#mt-04-在庫管理)
6. [MT-05: レシピ一覧・詳細](#mt-05-レシピ一覧詳細)
7. [MT-06: 設定・プロフィール](#mt-06-設定プロフィール)
8. [MT-07: ソーシャルフィード](#mt-07-ソーシャルフィード)
9. [バグ報告テンプレート](#バグ報告テンプレート)

---

## 1. テスト環境の準備

### 1.1 必要なサービス

| サービス | 起動コマンド | URL |
|---------|------------|-----|
| Next.js (Frontend + BFF) | `npm run dev` | http://localhost:3000 |
| Agent Server (FastAPI) | `cd agent && python -m uvicorn alcheme.server:app --reload --port 8001` | http://localhost:8001 |

### 1.2 環境変数

- `.env.local` が設定済みであること（Firebase、Google Cloud、楽天 API）
- `agent/.env` が設定済みであること（Vertex AI、Rakuten、Weather API）

### 1.3 テスト用ブラウザ設定

- **推奨**: Chrome DevTools のモバイルエミュレーション（Pixel 7: 412×915）
- DevTools > Toggle Device Toolbar (Ctrl+Shift+M) > Pixel 7 を選択
- 言語設定: 日本語 (ja-JP)

### 1.4 テスト用アカウント

| 用途 | メールアドレス | パスワード |
|------|-------------|-----------|
| 新規登録テスト | test123456@example.com | test123456 |
| 既存ユーザーテスト | test@example.com | password123 |

---

## MT-01: 認証フロー

### MT-01-A: 新規登録（メールアドレス）

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | `http://localhost:3000/signup` にアクセス | サインアップ画面が表示される（オーロラ背景、ガラスカード） | |
| 2 | 「alche:me」ロゴとタグラインが表示されることを確認 | ロゴ「A」アイコン + 「alche:me」テキスト + 「あなたのコスメの可能性を、もっと」 | |
| 3 | メールアドレスを入力 | 入力欄にテキストが入る | |
| 4 | パスワード「12345」を入力して「アカウント作成」 | 「パスワードは6文字以上で入力してください」エラー表示 | |
| 5 | パスワード「test123456」、確認「test999999」で送信 | 「パスワードが一致しません」エラー表示 | |
| 6 | 正しいパスワードを両方に入力して「アカウント作成」 | `/chat` に遷移、BottomNav が表示される | |

### MT-01-B: ログイン（メールアドレス）

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | `http://localhost:3000/login` にアクセス | ログイン画面が表示される（オーロラ背景、ガラスカード） | |
| 2 | サインアップ画面と同じデザインテーマであることを確認 | オーロラ背景 + ガラスカード + グラデーションボタン | |
| 3 | 間違ったパスワードでログイン | エラーメッセージが表示される(Firebase: Error (auth/invalid-credential).) | |
| 4 | 正しい認証情報でログイン | `/chat` に遷移 | |

### MT-01-C: Google ログイン

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | ログイン画面の「Googleでログイン」をタップ | Google OAuth ポップアップが表示される | |
| 2 | Google アカウントを選択 | `/chat` に遷移 | |

### MT-01-D: 認証ガード

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 未ログイン状態で `/chat` にアクセス | `/login` にリダイレクトされる | |
| 2 | 未ログイン状態で `/inventory` にアクセス | `/login` にリダイレクトされる | |
| 3 | 未ログイン状態で `/recipes` にアクセス | `/login` にリダイレクトされる | |
| 4 | 未ログイン状態で `/settings` にアクセス | `/login` にリダイレクトされる | |
| 5 | ログイン済みで `/login` にアクセス | `/chat` にリダイレクトされる | |

### MT-01-E: ログアウト

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 設定画面でログアウトボタンをタップ | ログイン画面に遷移 | |
| 2 | ログアウト後に `/chat` にアクセス | `/login` にリダイレクトされる | |

---

## MT-02: コスメ登録

### 前提条件
- ログイン済み
- テスト用コスメ画像を手元に準備（スマホで撮影した口紅、アイシャドウ等）
- Agent Server (`localhost:8001`) が起動済み（Web検索テスト時）
- `.env.local` に `RAKUTEN_APP_ID` が設定済み（楽天検索テスト時）

### MT-02-A: 登録方法選択シート

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | BottomNav の「コスメ」アイコンをタップ | 在庫一覧画面が表示される | |
| 2 | 右上の「＋」ボタンをタップ | 登録方法選択のボトムシートが表示される | |
| 3 | 4つの登録方法が表示されることを確認 | ①スキャン鑑定 ②楽天で検索 ③Web検索 ④手動で登録 | |
| 4 | 各カードにアイコン・タイトル・説明文があることを確認 | 正しいアイコンとテキストが表示される | |
| 5 | 在庫が0件の場合、EmptyState の「コスメを登録する」ボタンをタップ | 同じボトムシートが表示される | |

### MT-02-B: スキャン→登録フロー

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 登録方法選択シートで「スキャン鑑定」をタップ | スキャン画面 (`/scan`) に遷移する | |
| 2 | 「ライブラリから選択」をタップ | ファイル選択ダイアログが表示される | |
| 3 | コスメ画像を選択 | 鑑定演出アニメーションが開始される | |
| 4 | 鑑定が完了するまで待つ（3〜10秒） | 鑑定結果カードが表示される | |
| 5 | 鑑定結果のブランド名・商品名・カテゴリを確認 | 実際の商品と一致している（または近い） | |
| 6 | 「登録する」をタップ | 在庫一覧画面に遷移、登録したカードが表示される | |

### MT-02-C: 非コスメ画像

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 食べ物やペンなどの非コスメ画像をスキャン | 「コスメではないようです」等のメッセージが表示される | |

### MT-02-D: 楽天検索→登録フロー

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 登録方法選択シートで「楽天で検索」をタップ | 楽天検索画面 (`/add/search`) に遷移する | |
| 2 | ヘッダーに「楽天で検索」と戻るボタンが表示されることを確認 | PageHeader が正しく表示される | |
| 3 | 検索欄に「KATE リップモンスター」と入力して検索 | ローディング表示後、楽天商品の検索結果が一覧表示される | |
| 4 | 各結果カードに商品画像・商品名・価格・ショップ名が表示されることを確認 | 正しい情報が表示される | |
| 5 | 結果カードをタップ | ItemEditSheet が開き、楽天データ（商品名・価格・色番号等）がプリフィルされる | |
| 6 | カテゴリ・アイテム種別・テクスチャ等を補完入力 | フォームに入力できる | |
| 7 | 「登録する」をタップ | トースト通知が表示され、在庫一覧画面に遷移、登録したカードが表示される | |
| 8 | 検索結果が0件の場合を確認（存在しない商品名で検索） | 「該当する商品が見つかりませんでした」等のメッセージが表示される | |

### MT-02-E: Web検索→登録フロー

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 登録方法選択シートで「Web検索」をタップ | Web検索画面 (`/add/web-search`) に遷移する | |
| 2 | ヘッダーに「Web検索」と戻るボタンが表示されることを確認 | PageHeader が正しく表示される | |
| 3 | 検索欄に「MAC Ruby Woo」と入力して検索 | 「Web検索中...」のプログレス表示が出る（10〜20秒程度） | |
| 4 | 検索完了後、結果が一覧表示されることを確認 | ブランド名・商品名・色番号等が表示される | |
| 5 | 結果カードをタップ | ItemEditSheet が開き、検索データがプリフィルされる | |
| 6 | カテゴリ・アイテム種別等を補完入力して「登録する」 | トースト通知が表示され、在庫一覧画面に遷移、登録したカードが表示される | |

### MT-02-F: 手動登録フロー

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 登録方法選択シートで「手動で登録」をタップ | 手動登録画面 (`/add/manual`) に遷移する | |
| 2 | ヘッダーに「手動で登録」と戻るボタンが表示されることを確認 | PageHeader が正しく表示される | |
| 3 | フォームフィールドが全て表示されることを確認 | カテゴリ、アイテム種別、ブランド、商品名、色、テクスチャ、残量 | |
| 4 | 必須フィールド（ブランド、商品名）を空のまま登録を試みる | バリデーションエラーが表示される or 登録ボタンが無効 | |
| 5 | 全フィールドに値を入力: ブランド「KATE」、商品名「リップモンスター」、カテゴリ「リップ」 | フォームに入力できる | |
| 6 | 「登録する」をタップ | トースト通知が表示され、在庫一覧画面に遷移、登録したカードが表示される | |
| 7 | 在庫一覧で手動登録したアイテムを確認 | 入力した情報が正しく表示される | |

---

## MT-03: チャット・レシピ生成

### 前提条件
- ログイン済み
- コスメが 3 件以上登録済み
- Agent Server (`localhost:8001`) が起動済み

### MT-03-A: 基本的なチャット

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | BottomNav の「チャット」アイコンをタップ | チャット画面が表示される | |
| 2 | ウェルカムメッセージが表示されることを確認 | コンシェルジュからの挨拶が表示される | |
| 3 | 「おはよう」と入力して送信 | 温かい挨拶の返答が返ってくる（SSE ストリーミング） | |
| 4 | 返答テキストにゲーム用語（クエスト、デッキ等）が含まれていないことを確認 | ゲーム用語なし | |

### MT-03-B: レシピ生成（最重要テスト）

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 「今日はオフィスメイクを提案して」と送信 | コンシェルジュがテーマ案を3つ提示する（曖昧リクエストのため） | |
| 2 | **テーマ案がタップ可能なボタンとして表示されることを確認** | 1️⃣ 2️⃣ 3️⃣ のテーマがカード型ボタンで表示される（テキスト入力不要） | |
| 3 | テーマカードの1つをタップ | レシピ生成が開始される | |
| 4 | SSE ストリーミングが正常に動作することを確認 | テキストが段階的に表示される（チャンク単位） | |
| 5 | **レシピカードがインラインで表示されることを確認** | テキストだけでなく、ビジュアルなレシピカードコンポーネントが表示される | |
| 6 | **レシピカードにステップ一覧が表示されることを確認** | 各ステップに使用アイテム・手順が表示される | |
| 7 | **テキスト出力に思考プロセスが含まれていないことを確認** | 「リクエスト分析」「在庫チェック」「不足分の特定」等の思考テキストが表示されない | |
| 8 | **テキスト出力が簡潔であることを確認（2〜3文程度）** | レシピの紹介メッセージのみ。ステップ詳細はカードに表示される | |
| 9 | レシピ内の全アイテムが自分の在庫に存在することを確認 | 持っていないアイテムが含まれていない（Hallucination チェック） | |

### MT-03-C: プレビュー画像

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | レシピ生成後にプレビュー画像が表示されることを確認 | AI生成のイラスト画像がチャット内に表示される | |
| 2 | プレビュー画像が写真ではなくイラストであることを確認 | デジタルイラストスタイル | |
| 3 | プレビュー画像にメイクが反映されていることを確認 | レシピの色味等がイラストに反映されている | |

### MT-03-D: 具体的なリクエスト

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 「韓国風のナチュラルメイクを提案して」と送信 | テーマ提案なしで直接レシピが生成される（具体的なリクエスト） | |
| 2 | レシピカードが表示されることを確認 | ビジュアルなレシピカード + 簡潔な紹介テキスト | |

### MT-03-E: 範囲外の質問

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 「肌荒れがひどくて困っています」と送信 | 皮膚科の受診を推奨するメッセージ | |
| 2 | メイクとは関係ない質問を送信 | メイク関連の話題に誘導する返答 | |

---

## MT-04: 在庫管理

### 前提条件
- ログイン済み
- コスメが 1 件以上登録済み

### MT-04-A: 在庫一覧表示

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | BottomNav の「コスメ」アイコンをタップ | 在庫一覧画面が表示される | |
| 2 | 登録済みコスメがカード形式で表示されることを確認 | 各カードに商品名・ブランド名・画像が表示される | |
| 3 | カテゴリフィルタータブが表示されることを確認 | 「すべて」タブ + カテゴリタブが表示される | |
| 4 | カテゴリタブをタップ | 該当カテゴリのコスメのみ表示される | |

### MT-04-B: 在庫詳細

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | コスメカードをタップ | 詳細画面に遷移 | |
| 2 | 商品画像・商品名・ブランド名・カテゴリが表示される | 正しい情報が表示される | |
| 3 | 戻るボタンで一覧に戻る | 一覧画面に正しく戻る | |

### MT-04-C: 在庫削除

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 詳細画面の削除ボタンをタップ | 確認ダイアログが表示される | |
| 2 | 削除を確認 | 一覧に戻り、該当アイテムが消えている | |

---

## MT-05: レシピ一覧・詳細

### 前提条件
- ログイン済み
- チャットでレシピが 1 件以上生成済み

### MT-05-A: レシピ一覧

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | BottomNav の「レシピ」アイコンをタップ | レシピ一覧画面が表示される | |
| 2 | 生成済みレシピがカード形式で表示される | レシピ名・リクエスト内容・ステップ数が表示される | |
| 3 | プレビュー画像があるレシピにはサムネイルが表示される | 小さいプレビュー画像が表示される | |

### MT-05-B: レシピ詳細

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | レシピカードをタップ | レシピ詳細画面に遷移 | |
| 2 | レシピ名・リクエスト・再現度・ステップ数・日付が表示される | 正しい情報 | |
| 3 | プレビュー画像が表示される（ある場合） | 高解像度のプレビュー画像 | |
| 4 | ステップ一覧が表示される | 各ステップに手順・使用アイテムが表示される | |
| 5 | 「AIの思考プロセス」を展開できる | 折りたたみが開閉する | |
| 6 | 「プロのコツ」セクションが表示される（ある場合） | アドバイスが表示される | |

### MT-05-C: レシピ公開

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 「フィードに公開」ボタンをタップ | 「レシピを公開しました！」トースト通知 | |
| 2 | ボタンが「公開中」に変化 | 公開状態が反映される | |
| 3 | 「公開中」をタップして非公開に戻す | 「レシピを非公開にしました」トースト通知 | |

### MT-05-D: レシピ削除

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | 「削除」ボタンをタップ | 確認ダイアログが表示される | |
| 2 | 削除を確認 | レシピ一覧に戻り、該当レシピが消えている | |

### MT-05-E: レシピフィードバック

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | レシピ詳細画面でフィードバックセクションを確認 | いいね/評価 UI が表示される | |
| 2 | フィードバックを送信 | 評価が保存される | |

---

## MT-06: 設定・プロフィール

### 前提条件
- ログイン済み

### MT-06-A: 設定画面

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | BottomNav の「設定」アイコンをタップ | 設定画面が表示される | |
| 2 | プロフィール写真・ニックネームが表示される | 正しいユーザー情報 | |
| 3 | 各設定項目が表示される | プロフィール、アカウント等の設定メニュー | |

### MT-06-B: プロフィール編集

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | プロフィール写真の変更をタップ | ファイル選択ダイアログが表示される | |
| 2 | 新しい画像を選択 | アップロード中のスピナー表示後、新しい画像に変更される | |
| 3 | プロフィール画面でニックネームが表示される | 設定したニックネームが表示される | |

---

## MT-07: ソーシャルフィード

### 前提条件
- ログイン済み
- 公開済みレシピがある（自分または他のユーザー）

### MT-07-A: フィード表示

| # | 操作 | 期待結果 | OK/NG |
|---|------|---------|-------|
| 1 | フィードページにアクセス | 公開されたレシピ投稿が表示される | |
| 2 | 各投稿にプロフィール画像・ユーザー名・レシピ内容が表示される | 正しい情報が表示される | |
| 3 | 投稿をタップ | 投稿詳細画面に遷移 | |

---

## バグ報告テンプレート

バグを発見した場合は、以下のフォーマットで記録してください。

```
## バグ報告

**テストケース ID**: MT-XX-Y #Z
**発見日時**: YYYY-MM-DD HH:MM
**テスター**:

### 概要
（1文で問題を説明）

### 再現手順
1. ...
2. ...
3. ...

### 期待される結果
（本来どうなるべきか）

### 実際の結果
（実際に何が起きたか）

### スクリーンショット
（画面キャプチャを添付）

### ブラウザコンソールエラー
（DevTools Console に表示されたエラーがあれば）

### 環境
- ブラウザ: Chrome XX
- デバイスエミュレーション: Pixel 7
- OS: Windows 11 / macOS XX

### 重要度
- [ ] Critical（アプリが使えない）
- [ ] High（主要機能が動かない）
- [ ] Medium（機能は使えるが問題がある）
- [ ] Low（軽微な見た目の問題）
```

---

## チェックリスト集計

| テストセクション | テスト数 | Pass | Fail | Skip |
|----------------|---------|------|------|------|
| MT-01: 認証フロー | 15 | | | |
| MT-02: コスメ登録 | 33 | | | |
| MT-03: チャット・レシピ | 15 | | | |
| MT-04: 在庫管理 | 9 | | | |
| MT-05: レシピ一覧・詳細 | 13 | | | |
| MT-06: 設定・プロフィール | 6 | | | |
| MT-07: ソーシャルフィード | 3 | | | |
| **合計** | **94** | | | |
